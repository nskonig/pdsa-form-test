<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Best Start PDSA Form - Preview</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    const ACCENTS = {
      what:   '#3b82f6',
      why:    '#7c3aed',
      who:    '#be185d',
      how:    '#ea580c',
      where:  '#047857',
      when:   '#0f766e',
      refl:   '#b91c1c',
      topbar: '#0f766e'
    };

    const QuestionLabel = ({ children, color = '#334155' }) => (
      <div className="mb-4">
        <span
          style={{
            fontFamily: "Calibri, 'Segoe UI', Helvetica, Arial, sans-serif",
            fontSize: "1.9rem",
            fontWeight: 700,
            color
          }}
        >
          {children}
        </span>
      </div>
    );

    const MultiSelectDropdown = ({ label, secondaryLabel, subtitle, field, options, otherField, color, value, onChange, otherValue, onOtherChange }) => (
      <div className="mb-8 bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
        <QuestionLabel color={color}>{label}</QuestionLabel>
        {secondaryLabel && (
          <p className="text-sm font-medium text-slate-700 mb-2 -mt-2">{secondaryLabel}</p>
        )}
        {subtitle && <p className="text-sm text-slate-600 mb-4">{subtitle}</p>}

        <select
          multiple
          value={value}
          onChange={(e) => {
            const selected = Array.from(e.target.selectedOptions, o => o.value);
            onChange(selected);
          }}
          autoFocus={false}
          className="w-full px-4 py-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600 bg-white text-slate-800"
          style={{ minHeight: "200px" }}
        >
          {options.map(option => (
            <option key={option} value={option} className="py-2 px-2">
              {option}
            </option>
          ))}
        </select>

        <p className="text-sm text-slate-500 mt-2 italic">
          Hold Ctrl (Windows) or Cmd (Mac) to select multiple options
        </p>

        <div className="mt-4">
          <label className="block text-sm font-medium text-slate-700 mb-2">
            Other (please specify)
          </label>
          <input
            type="text"
            placeholder="Type here if your option is not listed above"
            value={otherValue || ""}
            onChange={(e) => onOtherChange(e.target.value)}
            className="w-full px-4 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600"
          />
        </div>
      </div>
    );

    const TextArea = ({ label, subtitle, field, placeholder, color, rows = 5, value, onChange }) => (
      <div className="mb-8 bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
        <QuestionLabel color={color}>{label}</QuestionLabel>
        {subtitle && <p className="text-sm text-slate-600 mb-4">{subtitle}</p>}
        <textarea
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder={placeholder}
          rows={rows}
          className="w-full px-4 py-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600 resize-y placeholder-slate-400 text-slate-800"
        />
      </div>
    );

    function ImprovedPDSAForm() {
      const [formData, setFormData] = useState({
        shortTermOutcome: [],
        shortTermOutcomeOther: '',
        changeCategory: [],
        changeCategoryOther: '',
        whatIdea: '',
        whyReason: '',
        whoTargetGroup: [],
        whoTargetGroupOther: '',
        whoServiceArea: [],
        whoServiceAreaOther: '',
        howSteps: '',
        where: [],
        whereOther: '',
        when: '',
        reflections: ''
      });

      const [submitStatus, setSubmitStatus] = useState({ state: 'idle', message: '' });

      const options = {
        shortTermOutcome: [
          'Relationship-based Practices',
          'Cultural Safety for Aboriginal families',
          'Family Awareness',
          'Active Outreach',
          'Service Continuity',
          'Service Accessibility'
        ],
        changeCategory: [
          'Enhancing administrative practices',
          'Enhancing service delivery and practices',
          'Enhancing partnership, improvement team engagement and collaboration',
          'Supporting and informing ECEC services',
          'Supporting and informing community and health services',
          'Supporting and informing families'
        ],
        whoTargetGroup: [
          'First Nations families and communities',
          'Families from culturally and linguistically diverse (CALD) backgrounds',
          'All families (broadly)',
          'Service teams and providers'
        ],
        whoServiceArea: [
          'MCH',
          'Playgroup programs',
          'Comprehensive service initiatives',
          'Kindergarten registration',
          'Early Start Kindergarten',
          'Kindergarten attendance and readiness',
          'Kindergarten enrichment',
          'Transition into primary school',
          'Emergency Relief and Basic Needs Support',
          'Family welfare and safety'
        ],
        where: [
          'Community setting',
          'Community and Health Services',
          'ECEC Centres',
          'Hub',
          'Library',
          'MCH centres',
          'Online',
          'Primary schools',
          'Supported playgroup site/session'
        ]
      };

      const handleInputChange = (field, value) => {
        setFormData(prev => ({ ...prev, [field]: value }));
      };

      const handleSubmit = async () => {
        setSubmitStatus({ state: 'loading', message: '' });
        
        try {
          const response = await fetch('https://defaulta5374a7a9ac14be5be4df624085ecf.bf.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/8920b0a1cb46450897f7c82b6aff9049/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=71Ge3eIRaSEeuipjzbMwy2wwm1Tfe90GjdqRkcp8oyE', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          if (response.ok) {
            setSubmitStatus({ state: 'success', message: 'Form submitted successfully!' });
            // Reset form after successful submission
            setTimeout(() => {
              setFormData({
                shortTermOutcome: [],
                shortTermOutcomeOther: '',
                changeCategory: [],
                changeCategoryOther: '',
                whatIdea: '',
                whyReason: '',
                whoTargetGroup: [],
                whoTargetGroupOther: '',
                whoServiceArea: [],
                whoServiceAreaOther: '',
                howSteps: '',
                where: [],
                whereOther: '',
                when: '',
                reflections: ''
              });
              setSubmitStatus({ state: 'idle', message: '' });
            }, 3000);
          } else {
            setSubmitStatus({ state: 'error', message: 'Submission failed. Please try again.' });
          }
        } catch (error) {
          setSubmitStatus({ state: 'error', message: 'Network error. Please check your connection and try again.' });
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100">
          <div className="max-w-4xl mx-auto p-6">
            <div
              className="mb-10 p-8 rounded-lg shadow-md text-white"
              style={{ background: ACCENTS.topbar }}
            >
              <h1 className="text-4xl font-bold mb-2">Best Start PDSA Form</h1>
              <p className="text-lg opacity-90">
                Use this form to document each Plan-Do-Study-Act cycle test.
              </p>
            </div>

            <MultiSelectDropdown
              label="Short Term Outcome"
              subtitle="Select the outcome areas this test aims to improve."
              options={options.shortTermOutcome}
              value={formData.shortTermOutcome}
              onChange={(val) => handleInputChange('shortTermOutcome', val)}
              otherValue={formData.shortTermOutcomeOther}
              onOtherChange={(val) => handleInputChange('shortTermOutcomeOther', val)}
              color={ACCENTS.topbar}
            />

            <MultiSelectDropdown
              label="Change Category"
              subtitle="The type of work or change you are making."
              options={options.changeCategory}
              value={formData.changeCategory}
              onChange={(val) => handleInputChange('changeCategory', val)}
              otherValue={formData.changeCategoryOther}
              onOtherChange={(val) => handleInputChange('changeCategoryOther', val)}
              color="#6d28d9"
            />

            <TextArea
              label="WHAT?"
              subtitle="The specific idea or activity you are testing."
              placeholder="E.g. Introduce Sunshine Circles at ECEC; Create multilingual enrolment flyers; Add MCH booking link to kinder registration; Run a Meet the MCH Nurse morning tea; Pilot joint playgroup with allied health."
              value={formData.whatIdea}
              onChange={(val) => handleInputChange('whatIdea', val)}
              color={ACCENTS.what}
            />

            <TextArea
              label="WHY?"
              subtitle="Why are you testing this change? What need or problem are you addressing?"
              placeholder="E.g. Families reported confusion about registration steps; Only 60% of Aboriginal families completed MCH visits; Services noticed duplicated referrals; Families asked for fewer assessments; Educators identified missing transition supports."
              value={formData.whyReason}
              onChange={(val) => handleInputChange('whyReason', val)}
              color={ACCENTS.why}
            />

            <div className="mb-8 bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
              <QuestionLabel color={ACCENTS.who}>WHO?</QuestionLabel>

              <p className="text-sm font-semibold text-slate-700 mb-2">Who benefits?</p>
              <select
                multiple
                value={formData.whoTargetGroup}
                onChange={(e) => {
                  const selected = Array.from(e.target.selectedOptions, o => o.value);
                  handleInputChange("whoTargetGroup", selected);
                }}
                autoFocus={false}
                className="w-full px-4 py-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600 bg-white text-slate-800"
                style={{ minHeight: "150px" }}
              >
                {options.whoTargetGroup.map(option => (
                  <option key={option} value={option}>{option}</option>
                ))}
              </select>
              <p className="text-sm text-slate-500 mt-2 italic">
                Hold Ctrl (Windows) or Cmd (Mac) to select multiple options
              </p>
              <div className="mt-3">
                <label className="block text-sm font-medium text-slate-700 mb-2">Other (please specify)</label>
                <input
                  type="text"
                  placeholder="Type here if your option is not listed above"
                  value={formData.whoTargetGroupOther}
                  onChange={(e) => handleInputChange("whoTargetGroupOther", e.target.value)}
                  className="w-full px-4 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600"
                />
              </div>

              <div className="mt-6">
                <p className="text-sm font-semibold text-slate-700 mb-2">Service context</p>
                <select
                  multiple
                  value={formData.whoServiceArea}
                  onChange={(e) => {
                    const selected = Array.from(e.target.selectedOptions, o => o.value);
                    handleInputChange("whoServiceArea", selected);
                  }}
                  autoFocus={false}
                  className="w-full px-4 py-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600 bg-white text-slate-800"
                  style={{ minHeight: "150px" }}
                >
                  {options.whoServiceArea.map(option => (
                    <option key={option} value={option}>{option}</option>
                  ))}
                </select>
                <p className="text-sm text-slate-500 mt-2 italic">
                  Hold Ctrl (Windows) or Cmd (Mac) to select multiple options
                </p>
                <div className="mt-3">
                  <label className="block text-sm font-medium text-slate-700 mb-2">Other (please specify)</label>
                  <input
                    type="text"
                    placeholder="Type here if your option is not listed above"
                    value={formData.whoServiceAreaOther}
                    onChange={(e) => handleInputChange("whoServiceAreaOther", e.target.value)}
                    className="w-full px-4 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600"
                  />
                </div>
              </div>
            </div>

            <TextArea
              label="HOW?"
              subtitle="What practical steps will you take to make this happen?"
              placeholder="E.g. Co-design flyers with bicultural workers; Hold weekly planning huddles between MCH and playgroup; Pilot a shared referral form; Track attendance weekly and adjust timing; Send SMS reminders to families."
              value={formData.howSteps}
              onChange={(val) => handleInputChange('howSteps', val)}
              color={ACCENTS.how}
            />

            <MultiSelectDropdown
              label="WHERE?"
              subtitle="The physical or virtual location(s) where this will happen."
              options={options.where}
              value={formData.where}
              onChange={(val) => handleInputChange('where', val)}
              otherValue={formData.whereOther}
              onOtherChange={(val) => handleInputChange('whereOther', val)}
              color={ACCENTS.where}
            />

            <div className="mb-8 bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
              <QuestionLabel color={ACCENTS.when}>WHEN?</QuestionLabel>
              <p className="text-sm text-slate-600 mb-4">The timeframe for testing this change.</p>
              <textarea
                value={formData.when}
                onChange={(e) => handleInputChange("when", e.target.value)}
                placeholder="E.g. Term 1 pilot (6 weeks starting Feb); One-off event in March; Ongoing with monthly review; Term 3 short trial followed by reflection."
                rows={2}
                className="w-full px-4 py-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-600 focus:border-teal-600 resize-y placeholder-slate-400 text-slate-800"
              />
            </div>

            <TextArea
              label="REFLECTIONS"
              subtitle="What worked, what did not, and what you would change next time."
              placeholder="E.g. Families engaged more when staff co-facilitated; Flyer text was dense; Attendance dropped after location change; Build in monthly reflection time."
              value={formData.reflections}
              onChange={(val) => handleInputChange('reflections', val)}
              color={ACCENTS.refl}
            />

            <div className="bg-white shadow-md rounded-lg p-8 mt-8">
              <button
                onClick={handleSubmit}
                disabled={submitStatus.state === 'loading'}
                className="bg-teal-700 hover:bg-teal-800 text-white font-semibold px-8 py-3 rounded-md transition-colors shadow disabled:bg-gray-400 disabled:cursor-not-allowed"
              >
                {submitStatus.state === 'loading' ? 'Submitting...' : 'Submit'}
              </button>
              
              {submitStatus.state === 'success' && (
                <div className="mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
                  {submitStatus.message}
                </div>
              )}
              
              {submitStatus.state === 'error' && (
                <div className="mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
                  {submitStatus.message}
                </div>
              )}
              
              <p className="text-sm text-slate-500 mt-4">
                Never submit passwords or private information through this form.
              </p>
            </div>

            <div className="mt-8 text-center text-sm text-slate-500">
              <p>Best Start Collaboration</p>
              <p className="mt-2">
                This content is for improvement work. Data you submit is shared with the project team only.
              </p>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<ImprovedPDSAForm />);
  </script>
</body>
</html>

